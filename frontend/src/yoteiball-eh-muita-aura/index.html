<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Desafio Tsubasa - Modo Hist√≥ria</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
      :root {
        --primary-color: #0d2240;
        --accent-color: #2c3e50;
        --bg-color: #f0f2f5;
        --white: #ffffff;
        --success: #27ae60;
        --danger: #e74c3c;
        --border: #dfe6e9;
      }

      body {
        font-family: 'Roboto', sans-serif;
        background-color: var(--bg-color);
        margin: 0;
        padding: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        box-sizing: border-box;
      }

      .container {
        background-color: #fcfbf8;
        width: 100%;
        max-width: 600px;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        text-align: center;
      }

      h2 {
        color: var(--primary-color);
        margin: 0 0 10px 0;
        font-size: 1.5rem;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .level-badge {
        background-color: var(--accent-color);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        margin-bottom: 20px;
        display: inline-block;
      }

      /* √Årea do desenho SVG */
      .hangman-drawing-area {
        height: 150px;
        margin-bottom: 10px;
        color: var(--accent-color);
      }

      .hangman-part {
        display: none;
        stroke: var(--primary-color);
        stroke-width: 4;
        stroke-linecap: round;
        fill: none;
      }

      /* √Årea de Constru√ß√£o da Frase */
      .sentence-builder {
        color: #7f8c8d;
        font-size: 1.1rem;
        margin-bottom: 5px;
        font-style: italic;
        min-height: 25px;
      }

      .enigma-box {
        background-color: #e8f4fd;
        border: 1px solid #b6e1fc;
        color: #0d2240;
        padding: 10px;
        border-radius: 8px;
        margin: 10px 0;
        font-size: 0.95rem;
      }

      /* Palavra Atual */
      .word-display {
        font-size: 2rem;
        font-weight: bold;
        letter-spacing: 0.5rem;
        margin: 20px 0;
        color: var(--primary-color);
        min-height: 40px;
        word-wrap: break-word;
      }

      .keyboard {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 6px;
        margin-top: 20px;
      }

      .key-btn {
        background-color: var(--white);
        border: 1px solid var(--border);
        color: var(--primary-color);
        font-size: 1rem;
        font-weight: bold;
        padding: 12px 5px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .key-btn:hover:not(:disabled) {
        background-color: var(--primary-color);
        color: white;
      }

      .key-btn:disabled {
        cursor: not-allowed;
        opacity: 0.6;
      }
      .key-btn.correct {
        background-color: var(--success);
        color: white;
        border-color: var(--success);
      }
      .key-btn.wrong {
        background-color: var(--danger);
        color: white;
        border-color: var(--danger);
      }

      .btn-reset {
        background-color: var(--primary-color);
        color: white;
        width: 100%;
        padding: 14px;
        border: none;
        border-radius: 6px;
        font-size: 1rem;
        font-weight: bold;
        cursor: pointer;
        margin-top: 25px;
        transition: background 0.3s;
        text-transform: uppercase;
        display: none;
      }
      .btn-reset:hover {
        background-color: #1a3a5e;
      }

      .back-link {
        display: block;
        margin-top: 20px;
        color: #666;
        text-decoration: none;
        font-size: 0.9rem;
      }

      .swal2-popup {
        font-family: 'Roboto', sans-serif !important;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Desafio Secreto</h2>
      <div id="levelDisplay" class="level-badge">Fase 1/3</div>

      <svg class="hangman-drawing-area" viewBox="0 0 200 180">
        <g stroke="var(--accent-color)" stroke-width="4" stroke-linecap="round">
          <line x1="20" y1="170" x2="180" y2="170" />
          <line x1="50" y1="170" x2="50" y2="20" />
          <line x1="50" y1="20" x2="130" y2="20" />
          <line x1="130" y1="20" x2="130" y2="40" />
        </g>
        <circle id="part-1" class="hangman-part" cx="130" cy="60" r="20" />
        <line
          id="part-2"
          class="hangman-part"
          x1="130"
          y1="80"
          x2="130"
          y2="130"
        />
        <line
          id="part-3"
          class="hangman-part"
          x1="130"
          y1="90"
          x2="100"
          y2="110"
        />
        <line
          id="part-4"
          class="hangman-part"
          x1="130"
          y1="90"
          x2="160"
          y2="110"
        />
        <line
          id="part-5"
          class="hangman-part"
          x1="130"
          y1="130"
          x2="100"
          y2="160"
        />
        <line
          id="part-6"
          class="hangman-part"
          x1="130"
          y1="130"
          x2="160"
          y2="160"
        />
      </svg>

      <div id="sentenceBuilder" class="sentence-builder">...</div>

      <div id="enigmaDisplay" class="enigma-box">üí° Dica: Carregando...</div>

      <div id="wordDisplay" class="word-display"></div>

      <div id="keyboard" class="keyboard"></div>

      <button id="btnReset" class="btn-reset" onclick="restartFullGame()">
        Reiniciar Desafio üîÑ
      </button>
      <a href="index.html" class="back-link">‚Üê Voltar</a>
    </div>

    <script>
      // --- CONFIGURA√á√ÉO DOS N√çVEIS (Modo Hist√≥ria) ---
      // Connector: Texto que aparece ANTES da palavra quando chega na fase
      const LEVELS = [
        {
          word: 'ASAS',
          hint: 'Sou o s√≠mbolo da liberdade. Anjos t√™m, avi√µes t√™m e os jogadores do Tsubasa carregam no nome. O que somos?',
          connector: 'Nossas ', // Come√ßa a frase com letra mai√∫scula no conector
        },
        {
          word: 'VOAM',
          hint: 'N√£o √© caminhar, n√£o √© nadar. √â o que se faz no c√©u. O que a bola faz depois de um saque viagem perfeito?',
          connector: ' ',
        },
        {
          word: 'YOTEIBALL',
          hint: 'Sou digital, verde ou azul, e vivo pedindo para voc√™ confirmar presen√ßa. Sem mim, o time n√£o se re√∫ne. Quem sou eu?',
          connector: ' pelo ', // Conector explicativo
        },
      ]

      const MAX_MISTAKES = 6

      // --- ESTADO GLOBAL ---
      let currentLevelIndex = 0
      let guessedLetters = new Set()
      let globalMistakes = 0 // Vida persistente entre as fases
      let completedSentence = '' // Guarda a frase montada

      // --- ELEMENTOS ---
      const wordDisplay = document.getElementById('wordDisplay')
      const keyboardDiv = document.getElementById('keyboard')
      const enigmaDisplay = document.getElementById('enigmaDisplay')
      const sentenceBuilder = document.getElementById('sentenceBuilder')
      const levelDisplay = document.getElementById('levelDisplay')
      const btnReset = document.getElementById('btnReset')
      const hangmanParts = document.querySelectorAll('.hangman-part')

      // --- INICIALIZA√á√ÉO ---
      function initLevel() {
        // Pega dados do n√≠vel atual
        const currentLevelData = LEVELS[currentLevelIndex]

        // Atualiza UI
        levelDisplay.innerText = `Fase ${currentLevelIndex + 1}/${LEVELS.length}`
        enigmaDisplay.innerHTML = `üí° <strong>Enigma:</strong> ${currentLevelData.hint}`

        // Mostra o que j√° foi completado da frase
        // Se for nivel 1, mostra reticencias, senao mostra a frase + conector atual
        if (currentLevelIndex === 0) {
          sentenceBuilder.innerText = 'Descubra a primeira palavra...'
        } else {
          sentenceBuilder.innerText =
            completedSentence + currentLevelData.connector + '...'
        }

        // Reseta letras chutadas (mas N√ÉO os erros globais)
        guessedLetters.clear()

        // Gera teclado e display
        generateKeyboard()
        updateWordDisplay()
      }

      function restartFullGame() {
        currentLevelIndex = 0
        globalMistakes = 0
        completedSentence = ''

        // Esconde bot√£o reset
        btnReset.style.display = 'none'

        // Limpa boneco
        hangmanParts.forEach((part) => (part.style.display = 'none'))

        // Habilita teclado
        initLevel()
      }

      function generateKeyboard() {
        keyboardDiv.innerHTML = ''
        const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('')

        alphabet.forEach((letter) => {
          const btn = document.createElement('button')
          btn.innerText = letter
          btn.classList.add('key-btn')
          btn.id = `key-${letter}`
          btn.onclick = () => handleGuess(letter)
          keyboardDiv.appendChild(btn)
        })
      }

      function handleGuess(letter) {
        guessedLetters.add(letter)
        const button = document.getElementById(`key-${letter}`)
        button.disabled = true

        const currentWord = LEVELS[currentLevelIndex].word

        if (currentWord.includes(letter)) {
          button.classList.add('correct')
          updateWordDisplay()
          checkWinCondition()
        } else {
          button.classList.add('wrong')
          globalMistakes++
          updateHangman()
          checkLossCondition()
        }
      }

      function updateWordDisplay() {
        const currentWord = LEVELS[currentLevelIndex].word
        const displayArray = currentWord.split('').map((char) => {
          return guessedLetters.has(char) ? char : '_'
        })
        wordDisplay.innerText = displayArray.join(' ')
      }

      function updateHangman() {
        // Mostra partes baseado no erro global
        const partToShow = document.getElementById(`part-${globalMistakes}`)
        if (partToShow) partToShow.style.display = 'block'
      }

      function checkWinCondition() {
        const currentWord = LEVELS[currentLevelIndex].word
        const displayed = wordDisplay.innerText.replace(/ /g, '')

        if (displayed === currentWord) {
          // ACERTOU A PALAVRA DO N√çVEL!

          // Adiciona a palavra √† frase completa
          const levelData = LEVELS[currentLevelIndex]
          completedSentence += levelData.connector + levelData.word

          // Anima√ß√£ozinha
          Swal.fire({
            icon: 'success',
            title: 'Correto!',
            text: `Voc√™ descobriu: ${levelData.word}`,
            timer: 1500,
            showConfirmButton: false,
          }).then(() => {
            // Avan√ßa de fase
            currentLevelIndex++

            if (currentLevelIndex < LEVELS.length) {
              // Tem mais fases
              initLevel()
            } else {
              // ZEROU O JOGO
              finishGame(true)
            }
          })
        }
      }

      function checkLossCondition() {
        if (globalMistakes >= MAX_MISTAKES) {
          finishGame(false)
        }
      }

      function finishGame(won) {
        // Desabilita tudo
        const keys = document.querySelectorAll('.key-btn')
        keys.forEach((key) => (key.disabled = true))
        btnReset.style.display = 'block'

        if (won) {
          sentenceBuilder.innerText = 'Frase Completa:'
          wordDisplay.innerText = completedSentence
          wordDisplay.style.fontSize = '1.5rem'

          Swal.fire({
            icon: 'success',
            title: 'Parab√©ns!',
            text: 'Voc√™ completou o enigma do Tsubasa!',
            confirmButtonText: 'Somos Tsubasa! üèê',
            confirmButtonColor: '#0d2240',
          })
          enigmaDisplay.innerHTML = `üéâ <strong>${completedSentence}</strong> üéâ`
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Game Over',
            text: 'O boneco foi completado antes da frase final.',
            confirmButtonColor: '#e74c3c',
          })
        }
      }

      // Inicia
      restartFullGame()
    </script>
  </body>
</html>
